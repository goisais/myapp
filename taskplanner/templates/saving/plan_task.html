{% extends "saving/base.html" %}
{% load static %}

{% block title %}プラン設計{% endblock %}
{% block header %}プラン設計{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'saving/plan_task.css' %}">
{% endblock %}

{% block content %}

<div class="tab-menu">
    <a href="{% url 'plan_task' %}" class="tab active">タスク追加</a>
    <a href="{% url 'plan_ai' %}" class="tab">AI相談</a>
</div>

<div class="schedule-container">
    <h2>タスク追加</h2>
    <form method="post">
        {% csrf_token %}

        <div class="form-group"><label>やりたい事</label>{{ form.title }}</div>
        <div class="form-group"><label>日時</label>{{ form.desired_at }}</div>
        <div class="form-group"><label>締切</label>{{ form.deadline }}</div>
        <div class="form-group"><label>優先度</label>{{ form.priority }}</div>
        <div class="form-group">
            <label>所要時間</label>
            {{ form.estimated_minutes }} {# hidden #}
            <div style="display:flex; gap:8px;">
                {{ form.duration_hours }}
                {{ form.duration_minutes }}
            </div>
        </div>
        <div class="form-group"><label>メモ</label>{{ form.memo }}</div>

        <button type="submit" class="submit-btn">追加</button>
    </form>

    <details class="task-panel" open >
        <summary class="task-panel-summary" style="margin-top:20px;">
            登録済みタスク（{{ tasks|length }}）
            <span class="task-panel-hint" >タップで開閉</span>
        </summary>

        {% for t in tasks %}
        <div class="schedule-item">
            <b>{{ t.title }}</b><br>

            日時:{% if t.desired_at %}
            {{ t.desired_at|date:"m/d H:i" }}
            {% else %}未定{% endif %}<br>

            締切:{% if t.deadline %}
            {{ t.deadline|date:"m/d H:i" }}
            {% else %}未定{% endif %}<br>

            所要時間: {% if t.estimated_minutes %}{{ t.estimated_minutes }}分{% else %}未定{% endif %} /
            優先度: {{ t.get_priority_display }}

            <div class="task-actions" style="margin-top:8px; display:flex; gap:8px;">
                <a href="{% url 'plan_task_edit' t.id %}" class="btn">編集</a>

                <form method="post" action="{% url 'plan_task_delete' t.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn danger" onclick="return confirm('削除しますか？');">削除</button>
                </form>
            </div>
        </div>
        {% empty %}
        <p>まだタスクがありません。</p>
        {% endfor %}
    </details>
</div>

{% endblock %}